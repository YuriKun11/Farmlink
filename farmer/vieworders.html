<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orders</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body class="bg-gray-100 font-sans">

    <header class="bg-white shadow-md py-4 px-6 sm:px-10 sticky top-0 z-50">
        <div class="max-w-screen-xl mx-auto flex items-center justify-between">
            <a href="/" class="text-green-500 font-bold text-2xl sm:text-3xl">FarmLink</a>

            <nav class="hidden md:flex items-center space-x-6">
                <a href="viewproducts.html" class="text-gray-700 hover:text-green-500 font-semibold">Products</a>
                <a href="#" class="text-green-500 border-b-2 border-green-500 font-semibold">Orders</a>
            </nav>

            <div class="flex items-center space-x-4">
                <a href="/notifications" class="relative">
                    <svg class="h-6 w-6 text-gray-600 cursor-pointer" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 00-6-6C6.91 5 5 6.91 5 11v3.158a2.032 2.032 0 01-1.405 1.405L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                    </svg>
                </a>

                <div class="relative">
                    <button class="flex items-center text-gray-700 hover:text-green-500 font-semibold focus:outline-none">
                        <svg class="h-6 w-6 text-gray-600 cursor-pointer" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                        </svg>
                        <span id="username">Loading...</span>
                    </button>
                </div>
            </div>

            <div class="relative md:hidden">
                <button id="mobile-menu-button" class="focus:outline-none">
                    <svg class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
                <div id="mobile-menu" class="absolute top-full right-0 bg-white shadow-md rounded-md py-2 hidden">
                    <a href="viewproducts.html" class="block px-4 py-2 text-gray-700 font-semibold hover:bg-gray-100">Products</a>
                    <a href="#" class="block px-4 py-2 text-green-500 font-semibold hover:bg-gray-100">Orders</a>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <h1 class="text-2xl font-semibold text-gray-800 mb-6">Orders list</h1>

        <div class="bg-white shadow-md rounded-lg overflow-x-auto">
            <table id="ordersTable" class="min-w-full divide-y divide-gray-200 text-sm sm:text-base">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-4 py-2 sm:px-6 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider">
                            Order Number
                        </th>
                        <th scope="col" class="px-4 py-2 sm:px-6 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider">
                            Product
                        </th>
                        <th scope="col" class="px-4 py-2 sm:px-6 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider">
                            Placed by
                        </th>
                        <th scope="col" class="px-4 py-2 sm:px-6 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider">
                            Date
                        </th>
                        <th scope="col" class="px-4 py-2 sm:px-6 sm:py-3 text-left text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider">
                            Status
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                   
                </tbody>
            </table>
        </div>

        <div class="bg-white shadow-md rounded-lg p-4 mt-6">
            <nav class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 text-center">
                <div class="text-sm text-gray-700">Showing 1 to 5 of XX results</div>
                <div class="flex justify-center sm:justify-start gap-2">
                    <a href="#" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-l-md focus:outline-none">&lt; Previous</a>
                    <a href="#" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 focus:outline-none">1</a>
                    <a href="#" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 focus:outline-none">2</a>
                    <a href="#" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-r-md focus:outline-none">Next &gt;</a>
                </div>
            </nav>
        </div>

    </div>

    <!-- Modal -->
<div id="statusModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg w-80 p-6">
      <h2 class="text-lg font-semibold mb-4">Update Order Status</h2>
      <select id="statusSelect" class="w-full border rounded px-3 py-2 mb-4">
        <option value="Pending">Pending</option>
        <option value="On the way">On the way</option>
        <option value="Picked up">Picked up</option>
        <option value="Delivered">Delivered</option>
      </select>
      <div class="flex justify-end space-x-2">
        <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
        <button onclick="updateStatus()" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">Save</button>
      </div>
    </div>
  </div>
  

    <script>
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
    </script>

<script>
    window.onload = function () {
        fetch('../backend/get_user.php')
            .then(res => res.json())
            .then(data => {
                if (data.status === "success") {
                    document.getElementById("username").innerText = `${data.username || data.email}`;
                } else {
                    document.getElementById("username").innerText = "Guest";
                }
            });

        //FETCH ORDERS FROM DATABAEs
        fetch('../backend/fetch_orders.php')
            .then(response => response.json())
            .then(data => {
                console.log(data)
                const tableBody = document.querySelector('#ordersTable tbody');
                data.forEach(order => {
                    const row = document.createElement('tr');
                    let statusClass = '';
                    
                    if (order.status === 'On the way') {
                        statusClass = 'bg-yellow-100 text-yellow-800';
                    } else if (order.status === 'Delivered') {
                        statusClass = 'bg-green-100 text-green-800';
                    } else if (order.status === 'Picked up') {
                        statusClass = 'bg-blue-100 text-blue-800';
                    } else if (order.status === 'Pending') {
                        statusClass = 'bg-gray-100 text-gray-800'; 
                    }

                    row.innerHTML = `
                        <td class="px-4 py-2 sm:px-6 sm:py-4 whitespace-nowrap cursor-pointer" onclick="openModal(${order.id}, '${order.status}')">
                            <div class="text-sm text-gray-900">${order.id}</div>
                        </td>
                       <td class="px-4 py-2 sm:px-6 sm:py-4 whitespace-nowrap cursor-pointer" onclick="openModal(${order.id}, '${order.status}')">
                            <div class="text-sm text-gray-500">${order.product_name}</div>
                        </td>
                       <td class="px-4 py-2 sm:px-6 sm:py-4 whitespace-nowrap cursor-pointer" onclick="openModal(${order.id}, '${order.status}')">
                            <div class="text-sm text-gray-500">${order.buyer_name}</div>
                        </td>
                        <td class="px-4 py-2 sm:px-6 sm:py-4 whitespace-nowrap cursor-pointer" onclick="openModal(${order.id}, '${order.status}')">
                            <div class="text-sm text-gray-500">${order.order_date}</div>
                        </td>
                       <td class="px-4 py-2 sm:px-6 sm:py-4 whitespace-nowrap cursor-pointer" onclick="openModal(${order.id}, '${order.status}')">
                            <span class="px-2 py-1 rounded-full ${statusClass} text-xs font-semibold">${order.status}</span>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            })
            .catch(error => {
                console.error('Error fetching orders:', error);
            });

    };
</script>

<script>
    // UPDATE ORDER STATUS using MODAL
    let selectedOrderId = null;

    function openModal(orderId, currentStatus) {
        selectedOrderId = orderId;
        document.getElementById("statusSelect").value = currentStatus;
        document.getElementById("statusModal").classList.remove("hidden");
        document.getElementById("statusModal").classList.add("flex");
    }
    function closeModal() {
        document.getElementById("statusModal").classList.add("hidden");
        document.getElementById("statusModal").classList.remove("flex");
        selectedOrderId = null;
    }
    function updateStatus() {
        const newStatus = document.getElementById("statusSelect").value;
        fetch('../backend/update_order_status.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: selectedOrderId, status: newStatus })
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === 'success') {
                location.reload(); 
            } else {
                alert('Failed to update status');
            }
        });
        closeModal();
    }
</script>


<script src="../js/Navigate.js"></script>

</body>
</html>